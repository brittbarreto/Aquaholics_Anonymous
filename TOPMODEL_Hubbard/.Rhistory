##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
plot(Sr0, hubbard_NS_jan_jun)
plot(Srmax, hubbard_NS_jan_jun)
Srmax <- runif(n, min = 0.05, max = 0.09)
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
qs0 <- runif(n, min = 0.00013, max = 0.00025)
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
qs0 <- runif(n, min = 0, max = 0.0003)
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
qs0 <- runif(n, min = 0.00016, max = 0.00018)
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
lnTe <- runif(n, min = -1.43, max = -1.2)
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
lnTe <- runif(n, min = -1.43, max = -1.34)
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
plot(Sr0, hubbard_NS_jan_jun)
plot(Srmax, hubbard_NS_jan_jun)
Srmax <- runif(n, min = 0.06, max = 0.08)
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
plot(Sr0, hubbard_NS_jan_jun)
plot(Srmax, hubbard_NS_jan_jun)
plot(Sr0, hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
lnTe <- runif(n, min = -1.41, max = -1.34)
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
##############visualizing parameters with NS#############################
plot(qs0, hubbard_NS_jan_jun)
plot(lnTe, hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
plot(Sr0, hubbard_NS_jan_jun)
plot(Srmax, hubbard_NS_jan_jun)
plot(Srmax, hubbard_NS_jan_jun)
plot(td, hubbard_NS_jan_jun)
plot(vch, hubbard_NS_jan_jun)
plot(vr, hubbard_NS_jan_jun)
plot(k0, hubbard_NS_jan_jun)
plot(CD, hubbard_NS_jan_jun)
n <- 1000
qs0 <- runif(n, min = 0.00016, max = 0.00018)
lnTe <- runif(n, min = -1.41, max = -1.34)
m <- runif(n, min = 0.15, max = 0.2)
Sr0 <- runif(n, min = 0.05, max = 0.2)
Srmax <- runif(n, min = 0.06, max = 0.08)
td <- runif(n, min = 0, max = 0.3)
vch <- runif(n, min = 100, max = 2500)
vr <- runif(n, min = 100, max = 2500)
k0 <- runif(n, min = 0.05, max = 0.15)
CD <- runif(n, min = 0, max = 5)
dt <- 24
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp, Qobs=hubbard_flow_ms)
max(hubbard_NS)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
hubbard_NS_aug_nov<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, aug_nov_rain, ETp, Qobs=aug_nov_flow_mday+0.002)
max(hubbard_NS_aug_nov)
####################Glue Sensititvty Analysis############################
parameters_glue<- parameters[hubbard_NS_jan_jun > 0.43,]
NS_glue <- hubbard_NS_jan_jun[hubbard_NS_jan_jun > 0.43]
View(parameters_glue)
####################Glue Sensititvty Analysis############################
parameters_glue<- parameters[hubbard_NS_jan_jun > 0.45,]
NS_glue <- hubbard_NS_jan_jun[hubbard_NS_jan_jun > 0.45]
View(parameters_glue)
n <- 1
qs0 <- runif(n, min = 0.00016, max = 0.00018)
lnTe <- runif(n, min = -1.41, max = -1.34)
m <- runif(n, min = 0.15, max = 0.2)
Sr0 <- runif(n, min = 0.05, max = 0.2)
Srmax <- runif(n, min = 0.06, max = 0.08)
td <- runif(n, min = 0, max = 0.3)
vch <- runif(n, min = 100, max = 2500)
vr <- runif(n, min = 100, max = 2500)
k0 <- runif(n, min = 0.05, max = 0.15)
CD <- runif(n, min = 0, max = 5)
dt <- 24
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
########################january-june##########################################
hubbard_sim_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
plot(hubbard_sim_jan_jun, type="l", col="blue", main="Jan-June Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_jan_jun-0.0025)
NSeff(jan_june_flow_mday, hubbard_sim_jan_jun-0.0025)
########################full year###########################################
hubbard_sim<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
plot(hubbard_flow_ms, type="l", col="blue", main="2016 Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim-0.0025)
NSeff(hubbard_flow_ms, hubbard_sim-0.0025)
########################Aug-Nov###############################################
hubbard_sim_aug_nov<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, aug_nov_rain, ETp)
plot(hubbard_sim_aug_nov, type="l", col="blue", main="Aug-Nov Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(aug_nov_flow_mday, type="l", col="blue", main="Aug-Nov Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_sim_aug_nov, type="l", col="blue", main="Aug-Nov Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(aug_nov_flow_mday, type="l", col="blue", main="Aug-Nov Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_aug_nov-0.002)
NSeff(aug_nov_flow_mday, hubbard_sim_aug_nov-0.002)
lines(hubbard_sim_aug_nov-0.0025)
NSeff(aug_nov_flow_mday, hubbard_sim_aug_nov-0.0025)
########################Aug-Nov###############################################
hubbard_sim_aug_nov<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, aug_nov_rain, ETp)
plot(aug_nov_flow_mday, type="l", col="blue", main="Aug-Nov Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_aug_nov-0.0025)
NSeff(aug_nov_flow_mday, hubbard_sim_aug_nov-0.0025)
fed_twi<-raster("hubbard_TopoWetIndex_local_ln.tif")
plot(fed_twi)
fed_topidx<-topidx(fed_twi, 10)$atb
fed_twi <-as.matrix(fed_twi)
is.na(fed_twi)
sum(is.na(fed_twi))
length(is.na(fed_twi))
fed_topidx<-topidx(fed_twi, 10)$atb
fed_topidx_class<-make.classes(fed_topidx, 25)
fed_topidx_class
fed_topidx_class<-make.classes(fed_topidx, 17)
fed_topidx_class
plot(fed_topidx_class)
fed_topidx_class<-make.classes(fed_topidx, 22)
fed_topidx_class
plot(fed_topidx_class)
fed_topidx_class<-make.classes(fed_topidx, 17)
fed_topidx_class
plot(fed_topidx_class)
########################full year###########################################
hubbard_sim<-topmodel(parameters, fed_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
plot(hubbard_sim, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_flow_ms, type="l", col="blue", main="2016 Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim-0.0025)
NSeff(hubbard_flow_ms, hubbard_sim-0.0025)
########################full year###########################################
hubbard_sim<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
plot(hubbard_sim, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_flow_ms, type="l", col="blue", main="2016 Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim-0.0025)
legend("topright", legend=c("modeled", "observed"),
col=c("blue", "black"), lty=1, cex=0.9)
NSeff(hubbard_flow_ms, hubbard_sim-0.0025)
hubbard_sim_jan_jun<-topmodel(parameters, fed_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
NSeff(jan_june_flow_mday, hubbard_sim_jan_jun-0.0025)
########################january-june##########################################
hubbard_sim_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
NSeff(jan_june_flow_mday, hubbard_sim_jan_jun-0.0025)
hubbard_sim_aug_nov<-topmodel(parameters, fed_topidx_class, hubbard_delay_classorder, aug_nov_rain, ETp)
plot(aug_nov_flow_mday, type="l", col="blue", main="Aug-Nov Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_aug_nov-0.0025)
NSeff(aug_nov_flow_mday, hubbard_sim_aug_nov-0.0025)
########################full year###########################################
hubbard_sim1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
hubbard_sim2<-topmodel(parameters, fed_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
hubbard_sim3<-topmodel(parameters, topidx_sink_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
plot(hubbard_sim1, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim2)
lines(hubbard_sim3)
plot(hubbard_sim1, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim3)
plot(hubbard_sim1, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_sim2, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_sim3, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_sim2, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_sim1, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim2)
lines(hubbard_sim3)
plot(hubbard_sim1, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_flow_ms, type="l", col="blue", main="2016 Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim2)
lines(hubbard_sim3)
plot(hubbard_flow_ms, type="l", col="blue", main="2016 Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim2)
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
hubbard_sim_jan_jun2<-topmodel(parameters, fed_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
hubbard_sim_jan_jun3<-topmodel(parameters, topidx_sink_class, hubbard_delay_classorder, jan_june_rain, ETp)
plot(hubbard_sim_jan_jun1, type="l", col="blue", main="Jan-June Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_jan_jun1-0.0025)
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_jan_jun2)
lines(hubbard_sim_jan_jun3)
plot(hubbard_sim_jan_jun1, type="l", col="blue", main="Jan-June Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_jan_jun2)
lines(hubbard_sim_jan_jun3)
lines(hubbard_sim_jan_jun1-0.0025)
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_jan_jun2)
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
library(readxl)
library(topmodel)
library(Hmisc)
library(tiff)
library(raster)
library(rgdal)
data(huagrahuma)
data(huagrahuma.dem)
attach(huagrahuma)
raster<-'hubbard_clipped.tif'
dem <-raster(raster)
plot(dem)
dem <-as.matrix(dem)
is.na(dem)
sum(is.na(dem))
length(is.na(dem))
fed_twi<-raster("hubbard_TopoWetIndex_local_ln.tif")
plot(fed_twi)
fed_twi <-as.matrix(fed_twi)
is.na(fed_twi)
fed_topidx<-topidx(fed_twi, 10)$atb
fed_topidx_class<-make.classes(fed_topidx, 17)
fed_topidx_class
plot(fed_topidx_class)
hubbard_topidx<-topidx(dem, 10)$atb
hubbard_topidx_class<-make.classes(hubbard_topidx, 11)
hubbard_topidx_class
plot(hubbard_topidx_class)
dem_sink<-sinkfill(dem, 10, 0.1)
topidx_sink<-topidx(dem_sink,10)$atb
topidx_sink_class<-make.classes(topidx_sink, 22)
topidx_sink_class
plot(topidx_sink_class)
hubbard_data<-read.csv("2016_hubbert_precip.csv")
hubbard_rain_mm<-hubbard_data$ï..Precip_2016_mm
hubbard_rain_m<-hubbard_rain_mm/1000
hubbard_rain_m
hubbard_flow_ls<-hubbard_data$Streamflow_l.s
hubbard_flow_ms<-hubbard_data$flow_m.s
hubbard_flow_ms
hubbard_data_jan_jun<-read.csv("2016_hubbert_jan1-june30.csv")
jan_june_rain<-hubbard_data_jan_jun$Precip_2016_m
jan_june_flow_mday<-hubbard_data_jan_jun$flow_m.day
hubbard_data_aug_nov<-read.csv("2016_hubbert_aug1_nov31.csv")
aug_nov_rain<-hubbard_data_aug_nov$Precip_2016_m
aug_nov_flow_mday<-hubbard_data_aug_nov$flow_m.day
k<-10
hubbard_delay_flowlength<-flowlength(dem)*10
hubbard_delay_class<-make.classes(hubbard_delay_flowlength,k)
hubbard_delay_class
plot(hubbard_delay_class)
hubbard_delay_classorder<- hubbard_delay_class[k:1,]
hubbard_delay_classorder
hubbard_delay_classorder[,2] <- c(0, cumsum(hubbard_delay_classorder[1:(k-1),2]))
hubbard_delay_classorder
########################full year###########################################
hubbard_sim1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
hubbard_sim2<-topmodel(parameters, fed_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
hubbard_sim3<-topmodel(parameters, topidx_sink_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
plot(hubbard_sim1, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim-0.0025)
plot(hubbard_sim1, type="l", col="blue", main="2016 Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim2)
plot(hubbard_flow_ms, type="l", col="blue", main="2016 Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim1)
lines(hubbard_sim2)
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
hubbard_sim_jan_jun2<-topmodel(parameters, fed_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
hubbard_sim_jan_jun3<-topmodel(parameters, topidx_sink_class, hubbard_delay_classorder, jan_june_rain, ETp)
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_jan_jun2)
lines(hubbard_sim_jan_jun1)
lines(hubbard_sim_jan_jun1'0.0025')
lines(hubbard_sim_jan_jun1-0.0025)
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, TRUE)
View(hubbard_sim_jan_jun1)
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, TRUE)
qo<-hubbard_sim_jan_jun1$qo
fex<-hubbard_sim_jan_jun1$fex
plot(qo-fex)
plot(qo-fex, type="l")
plot(hubbard_sim_jan_jun1, type="l", col="blue", main="Jan-June Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(hubbard_sim_jan_jun1, type="l", col="blue", main="Jan-June Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(qo-fex)
NSeff(jan_june_flow_mday, qo-fex)
Q<-hubbard_sim_jan_jun1$Q
fex<-hubbard_sim_jan_jun1$fex
lines(Q-fex)
NSeff(jan_june_flow_mday, Q-fex)
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
Q<-hubbard_sim_jan_jun1$Q
fex<-hubbard_sim_jan_jun1$fex
lines(Q-fex)
NSeff(jan_june_flow_mday, Q-fex)
Q<-hubbard_sim_jan_jun1$Q
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(Q)
lines(qo+qs+fex)
Q<-hubbard_sim_jan_jun1$Q
qo<-hubbard_sim_jan_jun1$qo
qs<-hubbard_sim_jan_jun1$qs
S<-hubbard_sim_jan_jun1$S
fex<-hubbard_sim_jan_jun1$fex
lines(qo+qs+fex, col="red")
lines(qs)
x
lines(qo+fex, col="red")
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(qo+fex+0.1*qs, col="red")
NSeff(jan_june_flow_mday, qo+fex+0.1*qs)
View(hubbard_sim_jan_jun1)
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(qs)
lines(Q)
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(qo+fex)
lines(qo+fex+0.1*qs, col="red")
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
NSeff(jan_june_flow_mday, qo+fex+0.1*qs)
lines(qo+fex+0.1*qs, col="red")
##################compare to python code##############################
rain_simple<-runiff(100,0,0)
##################compare to python code##############################
rain_simple<-runif(100,0,0)
##################compare to python code##############################
rain_simple<-runif(240,0,0)
ETp_simple<-runif(240,0,0)
run_sim<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, simple_rain, ETp_simple)
run_sim<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, rain_simple, ETp_simple)
plot(run_sim)
n <- 1
qs0 <- runif(n, min = 0.00016, max = 0.00018)
lnTe <- runif(n, min = -1.41, max = -1.34)
m <- runif(n, min = 0.15, max = 0.2)
Sr0 <- runif(n, min = 0.05, max = 0.2)
Srmax <- runif(n, min = 0.06, max = 0.08)
td <- runif(n, min = 0, max = 0.3)
vch <- runif(n, min = 100, max = 2500)
vr <- runif(n, min = 100, max = 2500)
k0 <- runif(n, min = 0.05, max = 0.15)
CD <- runif(n, min = 0, max = 5)
dt <- 24
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
run_sim<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, rain_simple, ETp_simple)
plot(run_sim)
run_sim_verbose<-topmodel(paramters, hubbard_topidx_class, hubbard_delay_classorder, rain_simple, ETp_simple, verbose=T)
run_sim_verbose<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, rain_simple, ETp_simple, verbose=T)
qs_simple<-run_sim_verbose$qs
plot(qs_simple)
View(run_sim_verbose)
run_sim_verbose<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, rain_simple, ETp_simple, verbose=T)
S_simple<-run_sim_verbose$S
plot(S)
plot(run_sim)
n <- 1000
qs0 <- runif(n, min = 0.00016, max = 0.00018)
lnTe <- runif(n, min = -1.41, max = -1.34)
m <- runif(n, min = 0.15, max = 0.2)
Sr0 <- runif(n, min = 0.05, max = 0.2)
Srmax <- runif(n, min = 0.06, max = 0.08)
td <- runif(n, min = 0, max = 0.3)
vch <- runif(n, min = 100, max = 2500)
vr <- runif(n, min = 100, max = 2500)
k0 <- runif(n, min = 0.05, max = 0.15)
CD <- runif(n, min = 0, max = 5)
dt <- 24
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
hubbard_NS_jan_jun<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, Qobs=jan_june_flow_mday+0.0025)
max(hubbard_NS_jan_jun)
plot(m, hubbard_NS_jan_jun)
library(readxl)
library(topmodel)
library(Hmisc)
library(tiff)
library(raster)
library(rgdal)
data(huagrahuma)
data(huagrahuma.dem)
attach(huagrahuma)
raster<-'hubbard_clipped.tif'
dem <-raster(raster)
plot(dem)
dem <-as.matrix(dem)
is.na(dem)
sum(is.na(dem))
length(is.na(dem))
####################################################################
hubbard_raster<-raster("hubbard_clipped.tif")
plot(hubbard_raster)
hubbard_topidx<-topidx(dem, 10)$atb
hubbard_topidx_class<-make.classes(hubbard_topidx, 11)
hubbard_topidx_class
plot(hubbard_topidx_class)
hubbard_data<-read.csv("2016_hubbert_precip.csv")
hubbard_rain_mm<-hubbard_data$ï..Precip_2016_mm
hubbard_rain_m<-hubbard_rain_mm/1000
hubbard_rain_m
hubbard_flow_ls<-hubbard_data$Streamflow_l.s
hubbard_flow_ms<-hubbard_data$flow_m.s
hubbard_flow_ms
hubbard_data_jan_jun<-read.csv("2016_hubbert_jan1-june30.csv")
jan_june_rain<-hubbard_data_jan_jun$Precip_2016_m
jan_june_flow_mday<-hubbard_data_jan_jun$flow_m.day
hubbard_data_aug_nov<-read.csv("2016_hubbert_aug1_nov31.csv")
aug_nov_rain<-hubbard_data_aug_nov$Precip_2016_m
aug_nov_flow_mday<-hubbard_data_aug_nov$flow_m.day
k<-10
hubbard_delay_flowlength<-flowlength(dem)*10
hubbard_delay_class<-make.classes(hubbard_delay_flowlength,k)
hubbard_delay_class
plot(hubbard_delay_class)
hubbard_delay_classorder<- hubbard_delay_class[k:1,]
hubbard_delay_classorder
hubbard_delay_classorder[,2] <- c(0, cumsum(hubbard_delay_classorder[1:(k-1),2]))
hubbard_delay_classorder
########################full year###########################################
hubbard_sim1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, hubbard_rain_m, ETp)
n <- 1
qs0 <- runif(n, min = 0.00016, max = 0.00018)
lnTe <- runif(n, min = -1.41, max = -1.34)
m <- runif(n, min = 0.15, max = 0.2)
Sr0 <- runif(n, min = 0.05, max = 0.2)
Srmax <- runif(n, min = 0.06, max = 0.08)
td <- runif(n, min = 0, max = 0.3)
vch <- runif(n, min = 100, max = 2500)
vr <- runif(n, min = 100, max = 2500)
k0 <- runif(n, min = 0.05, max = 0.15)
CD <- runif(n, min = 0, max = 5)
dt <- 24
parameters <- cbind(qs0,lnTe,m,Sr0,Srmax,td,vch,vr,k0,CD,dt)
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, TRUE)
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(jan_june_flow_mday)
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_jan_jun1)
plot(hubbard_sim_jan_jun1, type="l", col="blue", main="Jan-June Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
hubbard_data<-read.csv("2016_hubbert_precip.csv")
hubbard_rain_mm<-hubbard_data$ï..Precip_2016_mm
hubbard_rain_m<-hubbard_rain_mm/1000
hubbard_rain_m
hubbard_flow_ls<-hubbard_data$Streamflow_l.s
hubbard_flow_ms<-hubbard_data$flow_m.s
hubbard_flow_ms
hubbard_data_jan_jun<-read.csv("2016_hubbert_jan1-june30.csv")
jan_june_rain<-hubbard_data_jan_jun$Precip_2016_m
jan_june_flow_mday<-hubbard_data_jan_jun$flow_m.day
k<-10
hubbard_delay_flowlength<-flowlength(dem)*10
hubbard_delay_class<-make.classes(hubbard_delay_flowlength,k)
hubbard_delay_class
plot(hubbard_delay_class)
hubbard_delay_classorder<- hubbard_delay_class[k:1,]
hubbard_delay_classorder
hubbard_delay_classorder[,2] <- c(0, cumsum(hubbard_delay_classorder[1:(k-1),2]))
hubbard_delay_classorder
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, TRUE)
plot(hubbard_sim_jan_jun1, type="l", col="blue", main="Jan-June Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
View(hubbard_sim_jan_jun1)
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp)
plot(hubbard_sim_jan_jun1, type="l", col="blue", main="Jan-June Modeled Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(hubbard_sim_jan_jun1)
########################january-june##########################################
hubbard_sim_jan_jun1<-topmodel(parameters, hubbard_topidx_class, hubbard_delay_classorder, jan_june_rain, ETp, TRUE)
Q<-hubbard_sim_jan_jun1$Q
qo<-hubbard_sim_jan_jun1$qo
qs<-hubbard_sim_jan_jun1$qs
S<-hubbard_sim_jan_jun1$S
fex<-hubbard_sim_jan_jun1$fex
plot(jan_june_flow_mday, type="l", col="blue", main="Jan-June Observed Daily Flow for Hubbard Creek", xlab="Days", ylab="Flow")
lines(Q-qs)
lines(qs)
